<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VS</title>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;600;800&family=Poppins:wght@300;400;600&display=swap" rel="stylesheet">
    <style>
        /* Стилі залишаються без змін */
        body {
            margin: 0;
            overflow: hidden;
            height: 100vh;
            background: radial-gradient(circle at center, #0a0a23 0%, #1e1e5f 70%, #000 100%);
            display: flex;
            font-family: 'Poppins', sans-serif;
            color: #fff;
        }
        canvas {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 1;
        }
        .title {
            position: absolute;
            top: 20px;
            width: 100%;
            color: #00eaff;
            font-family: 'Orbitron', sans-serif;
            font-size: 80px;
            font-weight: 800;
            text-shadow: 0 0 20px rgba(0, 234, 255, 0.8), 0 0 40px rgba(0, 234, 255, 0.5);
            z-index: 2;
            text-align: center;
            letter-spacing: 5px;
            animation: neonGlow 1.5s ease-in-out infinite alternate;
        }
        @keyframes neonGlow {
            from { text-shadow: 0 0 20px rgba(0, 234, 255, 0.8), 0 0 40px rgba(0, 234, 255, 0.5); }
            to { text-shadow: 0 0 30px rgba(0, 234, 255, 1), 0 0 60px rgba(0, 234, 255, 0.7); }
        }
        .main-container {
            display: flex;
            width: 100%;
            height: 100vh;
            z-index: 3;
            position: relative;
        }
        .sidebar {
            width: 250px;
            background: rgba(10, 10, 35, 0.9);
            backdrop-filter: blur(15px);
            padding: 30px 20px;
            border-radius: 0 25px 25px 0;
            box-shadow: 5px 0 50px rgba(0, 234, 255, 0.3);
            display: flex;
            flex-direction: column;
            gap: 15px;
            animation: slideInLeft 1s ease-out;
            overflow-y: auto;
        }
        @keyframes slideInLeft {
            from { transform: translateX(-100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        .category-btn {
            background: linear-gradient(45deg, #1e90ff, #ff00ff);
            color: #fff;
            padding: 15px;
            border: none;
            border-radius: 10px;
            font-family: 'Orbitron', sans-serif;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 5px 20px rgba(0, 234, 255, 0.4);
            text-align: left;
        }
        .category-btn:hover, .category-btn.active {
            transform: translateX(5px);
            box-shadow: 0 8px 25px rgba(0, 234, 255, 0.6);
            background: linear-gradient(45deg, #ff00ff, #00eaff);
        }
        .product-panel {
            flex: 1;
            display: flex;
            flex-direction: row;
            flex-wrap: wrap;
            justify-content: center;
            align-items: flex-start;
            gap: 20px;
            padding: 50px;
            overflow-y: auto;
            animation: float 4s ease-in-out infinite;
        }
        @keyframes float {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }
        .product-card {
            width: 220px;
            background: linear-gradient(45deg, #1e90ff, #ff00ff);
            border-radius: 20px;
            padding: 15px;
            text-align: center;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        .product-card:hover {
            transform: scale(1.1) rotate(2deg);
            box-shadow: 0 15px 30px rgba(0, 234, 255, 0.5);
        }
        .product-image {
            width: 100%;
            height: 200px;
            background-size: cover;
            background-position: center;
            border-radius: 15px;
        }
        .product-info {
            margin-top: 10px;
            font-size: 16px;
            font-weight: 400;
            flex-grow: 1;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
        }
        .product-info h3 {
            margin: 5px 0;
            font-family: 'Orbitron', sans-serif;
            font-size: 20px;
            color: #00eaff;
        }
        .pay-button {
            background: linear-gradient(45deg, #ff00ff, #00eaff);
            color: #fff;
            padding: 12px 40px;
            border: none;
            border-radius: 10px;
            font-family: 'Orbitron', sans-serif;
            font-size: 18px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 5px 20px rgba(0, 234, 255, 0.4);
            margin-top: auto;
        }
        .pay-button:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(0, 234, 255, 0.6);
        }
        .pay-button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        .no-products {
            text-align: center;
            font-size: 18px;
            color: #00eaff;
            font-family: 'Orbitron', sans-serif;
            width: 100%;
        }
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.85);
            z-index: 4;
            justify-content: center;
            align-items: center;
            animation: fadeIn 0.4s ease;
        }
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        .modal-content {
            background: linear-gradient(135deg, #1a1a2e, #2a2a5e);
            padding: 40px;
            border-radius: 20px;
            width: 450px;
            max-width: 95%;
            text-align: center;
            box-shadow: 0 10px 50px rgba(0, 234, 255, 0.3);
            position: relative;
            animation: slideIn 0.4s ease;
            max-height: 85vh;
            overflow-y: auto;
            color: #fff;
        }
        @keyframes slideIn {
            from { transform: translateY(-100px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }
        .modal-content select, .modal-content input {
            width: 100%;
            padding: 12px;
            margin: 10px 0;
            border: 2px solid #00eaff;
            border-radius: 10px;
            box-sizing: border-box;
            font-size: 16px;
            background: rgba(255, 255, 255, 0.1);
            color: #fff !important;
            transition: border-color 0.3s ease, box-shadow 0.3s ease;
        }
        .modal-content select:focus, .modal-content input:focus {
            border-color: #ff00ff;
            box-shadow: 0 0 10px rgba(255, 0, 255, 0.5);
            outline: none;
        }
        .modal-content select option {
            background: #2a2a5e;
            color: #fff !important;
        }
        .modal-content .error {
            border-color: #ff4d4d;
        }
        .modal-content .error-message {
            color: #ff4d4d;
            font-size: 14px;
            margin: -5px 0 10px;
            display: none;
        }
        .modal-content button {
            background: linear-gradient(45deg, #ff00ff, #00eaff);
            color: #fff;
            padding: 12px 40px;
            border: none;
            border-radius: 10px;
            font-family: 'Orbitron', sans-serif;
            font-size: 18px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 5px 20px rgba(0, 234, 255, 0.4);
        }
        .modal-content button:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(0, 234, 255, 0.6);
        }
        .modal-content button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        .close {
            position: absolute;
            top: 15px;
            right: 20px;
            font-size: 30px;
            color: #00eaff;
            cursor: pointer;
            transition: color 0.3s ease, transform 0.3s ease;
        }
        .close:hover {
            color: #ff00ff;
            transform: rotate(90deg);
        }
        .loading {
            color: #00eaff;
            font-style: italic;
            font-size: 16px;
        }
        .search-container {
            position: relative;
            margin: 10px 0;
        }
        .search-input {
            width: 100%;
            padding: 12px;
            border: 2px solid #00eaff;
            border-radius: 10px;
            box-sizing: border-box;
            font-size: 16px;
            background: rgba(255, 255, 255, 0.1);
            color: #fff;
        }
        .search-input:focus {
            border-color: #ff00ff;
            box-shadow: 0 0 10px rgba(255, 0, 255, 0.5);
            outline: none;
        }
        .search-results, .postomat-list {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background: rgba(10, 10, 35, 0.9);
            border: 2px solid #00eaff;
            border-radius: 10px;
            max-height: 200px;
            overflow-y: auto;
            z-index: 10;
            display: none;
            box-shadow: 0 5px 20px rgba(0, 234, 255, 0.3);
        }
        .search-result-item, .postomat-item {
            padding: 12px;
            cursor: pointer;
            border-bottom: 1px solid rgba(0, 234, 255, 0.2);
            color: #fff;
            transition: background 0.2s ease;
        }
        .search-result-item:hover, .postomat-item:hover {
            background: rgba(0, 234, 255, 0.2);
        }
        .search-result-item:last-child, .postomat-item:last-child {
            border-bottom: none;
        }
        @media (max-width: 768px) {
            .title { font-size: 48px; padding: 15px 0; }
            .sidebar { width: 200px; padding: 20px 15px; }
            .product-panel { padding: 20px; gap: 15px; }
            .product-card { width: 160px; }
            .product-image { height: 140px; }
            .pay-button { padding: 10px 20px; font-size: 16px; }
            .modal-content { width: 90%; padding: 25px; }
        }
        @media (max-width: 480px) {
            .title { font-size: 36px; letter-spacing: 2px; }
            .main-container { flex-direction: column; }
            .sidebar { width: 100%; height: auto; border-radius: 25px 25px 0 0; }
            .product-panel { padding: 15px; flex-direction: column; align-items: center; }
            .product-card { width: 280px; max-width: 100%; }
            .product-image { height: 180px; }
            .pay-button { padding: 10px 30px; font-size: 16px; }
        }
    </style>
</head>
<body>
    <div class="title">VIZMU SOBI</div>
    <canvas id="spaceCanvas"></canvas>
    <div class="main-container">
        <nav class="sidebar">
            <button class="category-btn active" data-category="Всі">Всі товари</button>
            <button class="category-btn" data-category="Штани">Штани</button>
            <button class="category-btn" data-category="Кофти">Кофти</button>
            <button class="category-btn" data-category="Пончо">Пончо</button>
            <button class="category-btn" data-category="Одеяла">Одеяла</button>
        </nav>
        <div class="product-panel" id="productPanel">
            <!-- Продукти будуть рендеритися сюди -->
        </div>
    </div>
    <div class="modal" id="deliveryModal">
        <div class="modal-content">
            <span class="close" onclick="closeModal()">&times;</span>
            <h2>Оформлення замовлення</h2>
            <form id="deliveryForm">
                <select id="city" aria-label="Оберіть місто">
                    <option value="" disabled selected>Оберіть місто</option>
                    <option value="Київ">Київ</option>
                    <option value="Львів">Львів</option>
                    <option value="Одеса">Одеса</option>
                    <option value="Харків">Харків</option>
                    <option value="Дніпро">Дніпро</option>
                    <option value="Запоріжжя">Запоріжжя</option>
                    <option value="Вінниця">Вінниця</option>
                    <option value="Хмельницький">Хмельницький</option>
                    <option value="Чернівці">Чернівці</option>
                    <option value="Івано-Франківськ">Івано-Франківськ</option>
                    <option value="Тернопіль">Тернопіль</option>
                    <option value="Рівне">Рівне</option>
                    <option value="Луцьк">Луцьк</option>
                    <option value="Житомир">Житомир</option>
                    <option value="Черкаси">Черкаси</option>
                    <option value="Кропивницький">Кропивницький</option>
                    <option value="Миколаїв">Миколаїв</option>
                    <option value="Херсон">Херсон</option>
                    <option value="Суми">Суми</option>
                    <option value="Чернігів">Чернігів</option>
                </select>
                <div class="error-message" id="cityError">Будь ласка, оберіть місто</div>
                <div id="districtSection" style="display: none;">
                    <select id="district" aria-label="Оберіть район">
                        <option value="" disabled selected>Оберіть район (для Житомира)</option>
                        <option value="zhytomyr">Житомир</option>
                        <option value="berdychiv">Бердичів</option>
                        <option value="korosten">Коростень</option>
                        <option value="novohrad-volynskyi">Новоград-Волинський</option>
                    </select>
                </div>
                <div class="search-container">
                    <input type="text" id="postomatSearch" class="search-input" placeholder="Пошук поштомата або введіть адресу" aria-label="Пошук поштомата">
                    <div id="searchResults" class="search-results"></div>
                </div>
                <div id="postomatList" class="postomat-list"></div>
                <div id="postomatLoading" class="loading" style="display: none;">Завантажуємо поштомати...</div>
                <div id="postomatError" class="error-message" style="display: none;">Помилка завантаження поштоматів</div>
                <input type="text" id="deliveryAddress" placeholder="Введіть адресу доставки (якщо не поштомат)" aria-label="Адреса доставки">
                <div class="error-message" id="addressError">Будь ласка, введіть адресу або оберіть поштомат</div>
                <input type="text" id="name" placeholder="Ваше ім'я та прізвище" aria-label="Ім'я та прізвище">
                <div class="error-message" id="nameError">Будь ласка, введіть ім'я та прізвище</div>
                <input type="tel" id="phone" placeholder="Ваш номер телефону" aria-label="Номер телефону">
                <div class="error-message" id="phoneError">Будь ласка, введіть коректний номер телефону</div>
                <button id="submitButton" type="button" onclick="submitDelivery()">Відправити</button>
            </form>
        </div>
    </div>
    <script>
        const canvas = document.getElementById('spaceCanvas');
        const ctx = canvas.getContext('2d');

        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;

        const stars = [];
        const planets = [];
        const numStars = 200;

        class Star {
            constructor() {
                this.x = Math.random() * canvas.width;
                this.y = Math.random() * canvas.height;
                this.size = Math.random() * 4 + 2;
                this.speedX = (Math.random() - 0.5) * 0.5;
                this.speedY = (Math.random() - 0.5) * 0.5;
                this.opacity = Math.random() * 0.5 + 0.5;
                this.opacitySpeed = Math.random() * 0.02 + 0.01;
                this.phase = Math.random() * Math.PI * 2;
                const colors = ['#ffffff', '#ffeb3b', '#80d8ff', '#ff6f61', '#00eaff'];
                this.color = colors[Math.floor(Math.random() * colors.length)];
            }

            update() {
                this.x += this.speedX;
                this.y += this.speedY;
                this.opacity = 0.5 + 0.5 * Math.sin(this.phase);
                this.phase += this.opacitySpeed;
                if (this.x < 0) this.x = canvas.width;
                if (this.x > canvas.width) this.x = 0;
                if (this.y < 0) this.y = canvas.height;
                if (this.y > canvas.height) this.y = 0;
            }

            draw() {
                const gradient = ctx.createRadialGradient(this.x, this.y, 0, this.x, this.y, this.size * 2);
                gradient.addColorStop(0, `${this.color}${Math.round(this.opacity * 255).toString(16).padStart(2, '0')}`);
                gradient.addColorStop(1, `${this.color}00`);
                ctx.beginPath();
                ctx.arc(this.x, this.y, this.size, 0, Math.PI * 2);
                ctx.fillStyle = gradient;
                ctx.fill();
            }
        }

        class Planet {
            constructor(type) {
                this.x = Math.random() * canvas.width;
                this.y = Math.random() * canvas.height;
                this.size = Math.random() * 30 + 20;
                this.speedX = (Math.random() - 0.5) * 0.2;
                this.speedY = (Math.random() - 0.5) * 0.2;
                this.type = type || ['earth', 'mars', 'venus'][Math.floor(Math.random() * 3)];

                if (this.type === 'earth') {
                    this.color = '#00ff00';
                    this.overlayColor = '#87ceeb';
                } else if (this.type === 'mars') {
                    this.color = '#ff4500';
                    this.overlayColor = '#8b4513';
                } else if (this.type === 'venus') {
                    this.color = '#ffd700';
                    this.overlayColor = '#ffa500';
                }
            }

            update() {
                this.x += this.speedX;
                this.y += this.speedY;
                if (this.x < 0) this.x = canvas.width;
                if (this.x > canvas.width) this.x = 0;
                if (this.y < 0) this.y = canvas.height;
                if (this.y > canvas.height) this.y = 0;
            }

            draw() {
                ctx.beginPath();
                ctx.arc(this.x, this.y, this.size, 0, Math.PI * 2);
                ctx.fillStyle = this.color;
                ctx.fill();

                ctx.beginPath();
                if (this.type === 'earth') {
                    ctx.arc(this.x - this.size * 0.3, this.y - this.size * 0.2, this.size * 0.4, 0, Math.PI * 2);
                    ctx.fillStyle = this.overlayColor;
                    ctx.fill();
                    ctx.beginPath();
                    ctx.arc(this.x + this.size * 0.2, this.y + this.size * 0.3, this.size * 0.3, 0, Math.PI * 2);
                    ctx.fillStyle = '#ffffff';
                    ctx.fill();
                } else if (this.type === 'mars') {
                    ctx.arc(this.x - this.size * 0.2, this.y - this.size * 0.3, this.size * 0.5, 0, Math.PI * 2);
                    ctx.fillStyle = this.overlayColor;
                    ctx.fill();
                } else if (this.type === 'venus') {
                    ctx.arc(this.x + this.size * 0.3, this.y - this.size * 0.2, this.size * 0.4, 0, Math.PI * 2);
                    ctx.fillStyle = this.overlayColor;
                    ctx.fill();
                }

                ctx.strokeStyle = 'rgba(255, 255, 255, 0.3)';
                ctx.lineWidth = 2;
                ctx.stroke();
            }
        }

        for (let i = 0; i < numStars; i++) {
            stars.push(new Star());
        }
        for (let i = 0; i < 3; i++) {
            planets.push(new Planet(['earth', 'mars', 'venus'][i]));
        }

        function animate() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            stars.forEach(star => {
                star.update();
                star.draw();
            });
            planets.forEach(planet => {
                planet.update();
                planet.draw();
            });
            requestAnimationFrame(animate);
        }

        window.addEventListener('resize', () => {
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
        });

        animate();

        // Оновлений масив продуктів із новим товаром
        const products = [
            { name: 'Сорочка біла, Primark', price: '300 грн', image: 'https://i.postimg.cc/xT2TB5sw/de.webp', category: 'Пончо' },
            { name: 'Кофта чоловіча, XL', price: '299 грн', image: 'https://i.postimg.cc/Zqd51QSz/3dwed.webp', category: 'Кофти' },
            { name: 'Джинси на хлопчика 10-11 років', price: '315 грн', image: 'https://i.postimg.cc/8cPDPKq6/dd.webp', category: 'Штани' },
            { name: 'Спідниця-шорти на дівчинку 8-9 років', price: '199 грн', image: 'https://i.postimg.cc/kMhLbgSw/ee.webp', category: 'Пончо' },
            { name: 'Кофта на хлопчика 10-11 років', price: '245 грн', image: 'https://i.postimg.cc/BbGpxRqc/dws.webp', category: 'Кофти' },
            { name: 'Зелене Одеяло', price: '760 грн', image: 'https://i.postimg.cc/LsvNkhGW/f.webp', category: 'Одеяла' }
        ];

        // Оновлений масив категорій
        const categories = ['Всі', 'Штани', 'Кофти', 'Пончо', 'Одеяла'];
        const productPanel = document.getElementById('productPanel');
        const categoryBtns = document.querySelectorAll('.category-btn');
        let currentCategory = 'Всі';

        function renderProducts(category) {
            const filteredProducts = category === 'Всі' ? products : products.filter(p => p.category === category);
            productPanel.innerHTML = '';
            if (filteredProducts.length === 0) {
                productPanel.innerHTML = '<div class="no-products">Немає товарів у цій категорії</div>';
                return;
            }
            filteredProducts.forEach(product => {
                const card = document.createElement('div');
                card.className = 'product-card';
                card.innerHTML = `
                    <div class="product-image" style="background-image: url('${product.image}');"></div>
                    <div class="product-info">
                        <h3>${product.name}</h3>
                        <p>Ціна: ${product.price}</p>
                        <button class="pay-button" onclick="buyProduct('${product.name}', '${product.price}')">Купити</button>
                    </div>
                `;
                productPanel.appendChild(card);
            });
        }

        categoryBtns.forEach(btn => {
            btn.addEventListener('click', () => {
                categoryBtns.forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
                currentCategory = btn.dataset.category;
                renderProducts(currentCategory);
            });
        });

        // Початковий рендер
        renderProducts('Всі');

        const postomatsData = {
            "Київ": [
                "Поштомат №3002, Столичне шосе, 103 (БЦ Европа)",
                "Поштомат №3003, вул. Генерала Алмазова, 11",
                "Поштомат №3033, просп. Петра Григоренка, 33/44",
                "Поштомат №3034, вул. Здолбунівська, 17 (Ашан 2 поверх)",
                "Поштомат №3035, вул. Ревуцького, 26",
                "Поштомат №3038, просп. С. Бандери, 15А (Ашан 1 поверх)",
                "Поштомат №3040, вул. Єлизавети Чавдар, 13",
                "Поштомат №3041, вул. Колекторна, 3а",
                "Поштомат №3042, вул. Анни Ахматової, 31"
            ],
            "Львів": [
                "Поштомат №2001, вул. Городоцька, 160",
                "Поштомат №2002, вул. Зелена, 32",
                "Поштомат №2003, просп. Червоної Калини, 83",
                "Поштомат №25392, просп. Незалежності, 91 (маг. Тайстра)"
            ],
            "Одеса": [
                "Поштомат №4001, вул. Рішельєвська, 35",
                "Поштомат №4002, вул. Фонтанська дорога, 23"
            ],
            "Харків": [
                "Поштомат №3085, просп. Перемоги, 46 (№7)",
                "Поштомат №3158, вул. Клочківська, 99а (№50)",
                "Поштомат №3159, вул. Сумська, 48",
                "Поштомат №5001, просп. Героїв Харкова, 199"
            ],
            "Дніпро": [
                "Поштомат №6001, вул. Січеславська Набережна, 15",
                "Поштомат №6002, просп. Дмитра Яворницького, 50"
            ],
            "Запоріжжя": [
                "Поштомат №7001, вул. Перемоги, 141",
                "Поштомат №7002, просп. Соборний, 152"
            ],
            "Вінниця": [
                "Поштомат №8001, вул. Соборна, 89",
                "Поштомат №8002, вул. Київська, 36"
            ],
            "Хмельницький": [
                "Поштомат №9001, вул. Проскурівська, 24",
                "Поштомат №9002, вул. Кам'янецька, 114"
            ],
            "Чернівці": [
                "Поштомат №10001, вул. Головна, 266",
                "Поштомат №10002, вул. Українська, 32"
            ],
            "Івано-Франківськ": [
                "Поштомат №11001, вул. Галицька, 140",
                "Поштомат №11002, вул. Вовчинецька, 209"
            ],
            "Тернопіль": [
                "Поштомат №12001, вул. 15 Квітня, 7",
                "Поштомат №12002, просп. Злуки, 20"
            ],
            "Рівне": [
                "Поштомат №13001, вул. Соборна, 288",
                "Поштомат №13002, вул. Відінська, 15"
            ],
            "Луцьк": [
                "Поштомат №14001, вул. Лесі Українки, 67",
                "Поштомат №14002, просп. Волі, 6"
            ],
            "Житомир": {
                "zhytomyr": [
                    "Поштомат №15003, вул. Київська, 40",
                    "Поштомат №15004, майдан Перемоги, 2",
                    "Поштомат №15005, вул. Театральна, 12",
                    "Поштомат №15006, просп. Миру, 15"
                ],
                "berdychiv": [
                    "Поштомат №15007, вул. Європейська, 132",
                    "Поштомат №15008, вул. Шевченка, 50",
                    "Поштомат №15009, просп. Хіміків, 20"
                ],
                "korosten": [
                    "Поштомат №15010, вул. Грушевського, 52г",
                    "Поштомат №15011, вул. Довженка, 10",
                    "Поштомат №15012, просп. Перемоги, 25"
                ],
                "novohrad-volynskyi": [
                    "Поштомат №15013, вул. Олександра Чернявського, 46",
                    "Поштомат №15014, вул. Житомирська, 30",
                    "Поштомат №15015, майдан Шевченка, 5"
                ]
            },
            "Черкаси": [
                "Поштомат №16001, бульв. Шевченка, 307",
                "Поштомат №16002, вул. Хрещатик, 196"
            ],
            "Кропивницький": [
                "Поштомат №17001, вул. Велика Перспективна, 16",
                "Поштомат №17002, вул. Чорновола, 24"
            ],
            "Миколаїв": [
                "Поштомат №18001, вул. Адміральська, 25",
                "Поштомат №18002, просп. Центральний, 3"
            ],
            "Херсон": [
                "Поштомат №19001, вул. Суворова, 42",
                "Поштомат №19002, вул. 49-ї Гвардійської, 10"
            ],
            "Суми": [
                "Поштомат №20001, вул. Харківська, 42",
                "Поштомат №20002, просп. Шевченка, 29"
            ],
            "Чернігів": [
                "Поштомат №21001, вул. Шевченка, 79",
                "Поштомат №21002, просп. Перемоги, 127"
            ]
        };

        const modal = document.getElementById('deliveryModal');
        const citySelect = document.getElementById('city');
        const districtSelect = document.getElementById('district');
        const districtSection = document.getElementById('districtSection');
        const postomatSearch = document.getElementById('postomatSearch');
        const searchResults = document.getElementById('searchResults');
        const postomatList = document.getElementById('postomatList');
        const postomatLoading = document.getElementById('postomatLoading');
        const postomatError = document.getElementById('postomatError');
        const deliveryAddressInput = document.getElementById('deliveryAddress');
        const nameInput = document.getElementById('name');
        const phoneInput = document.getElementById('phone');
        const submitButton = document.getElementById('submitButton');
        const cityError = document.getElementById('cityError');
        const addressError = document.getElementById('addressError');
        const nameError = document.getElementById('nameError');
        const phoneError = document.getElementById('phoneError');

        let currentProduct = { name: '', price: '' };
        let currentPostomats = [];
        let searchTimeout;

        citySelect.addEventListener('change', loadDistrictsAndPostomats);
        districtSelect.addEventListener('change', loadPostomats);

        function buyProduct(name, price) {
            currentProduct = { name, price };
            openModal();
        }

        function loadDistrictsAndPostomats() {
            const city = citySelect.value;
            districtSection.style.display = 'none';
            searchResults.style.display = 'none';
            postomatSearch.value = '';
            postomatList.style.display = 'none';
            postomatLoading.style.display = 'none';
            postomatError.style.display = 'none';
            deliveryAddressInput.style.display = 'block';

            if (city && postomatsData[city] && typeof postomatsData[city] === 'object' && !Array.isArray(postomatsData[city])) {
                districtSection.style.display = 'block';
                districtSelect.value = localStorage.getItem('selectedDistrict') || '';
                currentPostomats = [];
                if (districtSelect.value) loadPostomats();
            } else if (city && Array.isArray(postomatsData[city])) {
                loadPostomatsFromArray(postomatsData[city]);
            } else {
                currentPostomats = [];
            }
        }

        function loadPostomats() {
            const city = citySelect.value;
            const district = districtSelect.value;
            searchResults.style.display = 'none';
            postomatSearch.value = '';
            postomatList.style.display = 'none';
            postomatLoading.style.display = 'block';
            postomatError.style.display = 'none';
            deliveryAddressInput.style.display = 'block';

            if (city && district && postomatsData[city] && postomatsData[city][district]) {
                loadPostomatsFromArray(postomatsData[city][district]);
            } else if (city && Array.isArray(postomatsData[city])) {
                loadPostomatsFromArray(postomatsData[city]);
            } else {
                currentPostomats = [];
                postomatLoading.style.display = 'none';
            }
        }

        function loadPostomatsFromArray(postomats) {
            setTimeout(() => {
                currentPostomats = postomats;
                displayPostomats(postomats);
                const savedAddress = localStorage.getItem('selectedPostomat');
                if (savedAddress && postomats.includes(savedAddress)) {
                    postomatSearch.value = savedAddress;
                    deliveryAddressInput.value = savedAddress;
                    deliveryAddressInput.style.display = 'none';
                }
                postomatLoading.style.display = 'none';
                postomatList.style.display = 'block';
            }, 800);
        }

        function displayPostomats(postomats) {
            postomatList.innerHTML = '';
            postomats.slice(0, 10).forEach(postomat => {
                const item = document.createElement('div');
                item.className = 'postomat-item';
                item.textContent = postomat;
                item.addEventListener('click', () => {
                    postomatSearch.value = postomat;
                    deliveryAddressInput.value = postomat;
                    deliveryAddressInput.style.display = 'none';
                    searchResults.style.display = 'none';
                    localStorage.setItem('selectedPostomat', postomat);
                });
                postomatList.appendChild(item);
            });
        }

        postomatSearch.addEventListener('input', function() {
            clearTimeout(searchTimeout);
            searchTimeout = setTimeout(() => {
                const query = this.value.toLowerCase().trim();
                if (query.length < 2) {
                    searchResults.style.display = 'none';
                    displayPostomats(currentPostomats);
                    return;
                }
                const filtered = currentPostomats.filter(addr => addr.toLowerCase().includes(query));
                displaySearchResults(filtered);
            }, 300);
        });

        function displaySearchResults(results) {
            searchResults.innerHTML = '';
            if (results.length === 0) {
                const noResult = document.createElement('div');
                noResult.className = 'search-result-item';
                noResult.textContent = 'Нічого не знайдено';
                searchResults.appendChild(noResult);
            } else {
                results.slice(0, 10).forEach(result => {
                    const item = document.createElement('div');
                    item.className = 'search-result-item';
                    item.textContent = result;
                    item.addEventListener('click', () => {
                        postomatSearch.value = result;
                        deliveryAddressInput.value = result;
                        deliveryAddressInput.style.display = 'none';
                        searchResults.style.display = 'none';
                        localStorage.setItem('selectedPostomat', result);
                    });
                    searchResults.appendChild(item);
                });
            }
            searchResults.style.display = 'block';
        }

        document.addEventListener('click', function(e) {
            if (!postomatSearch.contains(e.target) && !searchResults.contains(e.target)) {
                searchResults.style.display = 'none';
            }
        });

        postomatSearch.addEventListener('focus', function() {
            if (currentPostomats.length > 0 && this.value.trim()) {
                displaySearchResults(currentPostomats.filter(addr => addr.toLowerCase().includes(this.value.toLowerCase().trim())));
            }
        });

        function openModal() {
            modal.style.display = 'flex';
            const savedCity = localStorage.getItem('selectedCity');
            if (savedCity && citySelect.querySelector(`option[value="${savedCity}"]`)) {
                citySelect.value = savedCity;
                loadDistrictsAndPostomats();
            }
        }

        function closeModal() {
            modal.style.display = 'none';
            citySelect.value = '';
            districtSelect.value = '';
            districtSection.style.display = 'none';
            postomatSearch.value = '';
            postomatList.innerHTML = '';
            postomatList.style.display = 'none';
            deliveryAddressInput.value = '';
            deliveryAddressInput.style.display = 'block';
            nameInput.value = '';
            phoneInput.value = '';
            citySelect.classList.remove('error');
            deliveryAddressInput.classList.remove('error');
            nameInput.classList.remove('error');
            phoneInput.classList.remove('error');
            cityError.style.display = 'none';
            addressError.style.display = 'none';
            nameError.style.display = 'none';
            phoneError.style.display = 'none';
            postomatError.style.display = 'none';
            searchResults.style.display = 'none';
        }

        function validateForm() {
            let isValid = true;
            citySelect.classList.remove('error');
            deliveryAddressInput.classList.remove('error');
            nameInput.classList.remove('error');
            phoneInput.classList.remove('error');
            cityError.style.display = 'none';
            addressError.style.display = 'none';
            nameError.style.display = 'none';
            phoneError.style.display = 'none';

            if (!citySelect.value) {
                citySelect.classList.add('error');
                cityError.style.display = 'block';
                isValid = false;
            }
            if (citySelect.value === 'Житомир' && !districtSelect.value) {
                alert('Будь ласка, оберіть район для Житомира');
                isValid = false;
            }
            const address = deliveryAddressInput.value.trim() || postomatSearch.value.trim();
            if (!address) {
                deliveryAddressInput.classList.add('error');
                addressError.style.display = 'block';
                isValid = false;
            }
            if (!nameInput.value.trim()) {
                nameInput.classList.add('error');
                nameError.style.display = 'block';
                isValid = false;
            }
            const phoneRegex = /^\+?\d{10,12}$/;
            if (!phoneInput.value.trim() || !phoneRegex.test(phoneInput.value.trim())) {
                phoneInput.classList.add('error');
                phoneError.style.display = 'block';
                isValid = false;
            }
            return isValid;
        }

        async function submitDelivery() {
            if (!validateForm()) return;

            submitButton.disabled = true;
            submitButton.textContent = 'Відправка...';

            const city = citySelect.value;
            let district = '';
            if (city === 'Житомир') {
                district = districtSelect.value;
                localStorage.setItem('selectedDistrict', district);
            }
            const deliveryAddress = deliveryAddressInput.value.trim() || postomatSearch.value.trim();
            const name = nameInput.value.trim();
            const phone = phoneInput.value.trim();

            localStorage.setItem('selectedCity', city);
            localStorage.setItem('selectedPostomat', deliveryAddress);

            const webhookUrl = 'https://discord.com/api/webhooks/1422641023657705513/AdZtuDpO8fVTzm5KmQcGwYuRSvhbNztwAOgfvedHaHpEiykbGN4ARKUat5OkJAhID2XH';
            const payload = {
                content: `🌌 Нове замовлення:\nТовар: ${currentProduct.name}\nЦіна: ${currentProduct.price}\nМісто: ${city}${district ? `, Район: ${district}` : ''}\nАдреса доставки/поштомат: ${deliveryAddress}\nІм'я: ${name}\nТелефон: ${phone}`
            };

            try {
                const response = await fetch(webhookUrl, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(payload)
                });
                if (response.ok) {
                    alert('🚀 Замовлення успішно відправлено!');
                    closeModal();
                } else {
                    alert('Помилка при відправці замовлення. Спробуйте ще раз.');
                }
            } catch (error) {
                console.error('Error:', error);
                alert('Помилка при відправці замовлення. Спробуйте ще раз.');
            } finally {
                submitButton.disabled = false;
                submitButton.textContent = 'Відправити';
            }
        }
    </script>
</body>
</html>
